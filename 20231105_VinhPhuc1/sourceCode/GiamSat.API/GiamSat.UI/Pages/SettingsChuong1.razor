@page "/c/{ChuongId}"
@* @attribute [Authorize] *@
@attribute [Authorize(Roles = "Admin")]
@*@attribute [AllowAnonymous]*@

@using System.ComponentModel.DataAnnotations

@* @if (ChuongId != null)
{
    <SettingsChuong ChuongId="@ChuongId"></SettingsChuong>
} *@

@if (chuongInfo == null && stepModel == null)
{
    @*<MudText>Loading....</MudText>*@
    <div class="spinner center-div"></div>
}
else
{
    <EditForm Model="@stepModel" OnValidSubmit="OnValidSubmit" OnInvalidSubmit="OnInvalidSubmit">
        <DataAnnotationsValidator />

        <MudGrid Spacing="1" Class="m-2">
            <MudItem xs="12">
                <MudChip Style="@($"color:{_theme.Palette.White}; background:{_theme.Palette.DarkDarken};")" Class="d-flex">@stepModel.TenChuong</MudChip>
            </MudItem>
            <MudDivider></MudDivider>
            <MudItem xs="12">
                <MudCard Class="rounded-lg pb-4 h-100 border border-warning">
                    <MudCardContent>
                        <MudGrid Spacing="1" Class="pt-2">
                            <MudItem xs="12">
                                <MudCard Class="m-2">
                                    <MudCardHeader Style="@($"color:{_theme.Palette.White}; background:{_theme.Palette.SuccessDarken};")">
                                        Cài đặt giai đoạn
                                    </MudCardHeader>
                                    <MudCardContent>
                                        <MudGrid Spacing="1">
                                            <MudItem xs="12">
                                                <MudSelect @bind-Value="enumValue" Label="CHỌN GIAI ĐOẠN"
                                                           SelectedValuesChanged="(IEnumerable<StepRun>e)=>OnSelectedValuesChanged(e)"
                                                           HelperText="Chọn giai đoạn để cài đặt các thông số" HelperTextOnFocus="true"
                                                           OpenIcon="@Icons.Material.Filled.LocalDrink" AdornmentColor="Color.Secondary" Variant="Variant.Outlined">
                                                    @foreach (StepRun item in Enum.GetValues(typeof(StepRun)))
                                                    {
                                                        <MudSelectItem Value="@item">@item</MudSelectItem>
                                                    }
                                                </MudSelect>
                                            </MudItem>
                                            <MudItem xs="12">
                                                <MudGrid Spacing="1">
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Từ ngày" HelperText="Ngày bắt đầu giai đoạn" HelperTextOnFocus="true" Class="m-2"
                                                        @bind-Value="@stepModel.FromDate" For="@(()=>@stepModel.FromDate)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Đến ngày" HelperText="Ngày kết thúc giai đoạn" HelperTextOnFocus="true" Class="m-2"
                                                        @bind-Value="@stepModel.ToDate" For="@(()=>@stepModel.ToDate)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Số quạt chạy cố định" Class="m-2"
                                                        @bind-Value="@stepModel.StaticFanRun" For="@(()=>@stepModel.StaticFanRun)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Nhiệt bật dàn mát (oC)" Class="m-2"
                                                        @bind-Value="@stepModel.TempRunCooler" For="@(()=>@stepModel.LowFrequency)"></MudNumericField>
                                                    </MudItem>
                                                </MudGrid>
                                            </MudItem>
                                            <MudItem xs="12">
                                                <MudGrid Spacing="1">
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Nhiệt độ cao (oC)" Class="m-2"
                                                        @bind-Value="@stepModel.HightTemperature" For="@(()=>@stepModel.HightTemperature)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Nhiệt độ thấp (oC)" Class="m-2"
                                                        @bind-Value="@stepModel.Lowtemperature" For="@(()=>@stepModel.Lowtemperature)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Tần số cao (Hz)" Class="m-2"
                                                        @bind-Value="@stepModel.HightFrequency" For="@(()=>@stepModel.HightFrequency)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Tần số thấp (Hz)" Class="m-2"
                                                        @bind-Value="@stepModel.LowFrequency" For="@(()=>@stepModel.LowFrequency)"></MudNumericField>
                                                    </MudItem>
                                                </MudGrid>
                                            </MudItem>
                                            <MudItem xs="12">
                                                <MudGrid Spacing="1">
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Nhiệt độ bật quạt 1 (oC)" Class="m-2"
                                                        @bind-Value="@stepModel.TempRunFan1" For="@(()=>@stepModel.TempRunFan1)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Nhiệt độ bật quạt 2 (oC)" Class="m-2"
                                                        @bind-Value="@stepModel.TempRunFan2" For="@(()=>@stepModel.TempRunFan2)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Nhiệt độ bật quạt 3 (oC)" Class="m-2"
                                                        @bind-Value="@stepModel.TempRunFan3" For="@(()=>@stepModel.TempRunFan3)"></MudNumericField>
                                                    </MudItem>
                                                    <MudItem xs="12" sm="3">
                                                        <MudNumericField Label="Nhiệt độ bật quạt 4 (oC)" Class="m-2"
                                                        @bind-Value="@stepModel.TempRunFan4" For="@(()=>@stepModel.TempRunFan4)"></MudNumericField>
                                                    </MudItem>
                                                </MudGrid>
                                            </MudItem>
                                        </MudGrid>

                                    </MudCardContent>
                                </MudCard>
                            </MudItem>
                            <MudItem xs="12">
                                <MudCard Class="m-2">
                                    <MudCardHeader Style="@($"color:{_theme.Palette.White}; background:{_theme.Palette.SuccessDarken};")">
                                        Cài đặt chung
                                    </MudCardHeader>
                                    <MudCardContent>
                                        <MudGrid Spacing="1" Class="m-2">
                                            <MudItem xs="12" sm="6">
                                                <MudTextField Label="Tên chuồng" Class="m-2"
                                                @bind-Value="@stepModel.TenChuong" For="@(()=>@stepModel.TenChuong)"></MudTextField>
                                            </MudItem>
                                            <MudItem xs="12" sm="6">
                                                <MudNumericField Label="Thứ tự chuồng" Class="m-2"
                                                @bind-Value="@stepModel.NumIndex" For="@(()=>@stepModel.NumIndex)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Thời gian chạy dàn mát (phút)" Class="m-2"
                                                @bind-Value="@stepModel.TimeOnCooler" For="@(()=>@stepModel.TimeOnCooler)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Thời gian nghỉ dàn mát (phút)" Class="m-2"
                                                @bind-Value="@stepModel.TimeOffCooler" For="@(()=>@stepModel.TimeOffCooler)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Quạt 1" Class="m-2"
                                                @bind-Value="@stepModel.Fan1" For="@(()=>@stepModel.Fan1)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Quat 2" Class="m-2"
                                                @bind-Value="@stepModel.Fan2" For="@(()=>@stepModel.Fan2)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Quat 3" Class="m-2"
                                                @bind-Value="@stepModel.Fan3" For="@(()=>@stepModel.Fan3)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Quat 4" Class="m-2"
                                                @bind-Value="@stepModel.Fan4" For="@(()=>@stepModel.Fan4)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Ngày hiện tại" Class="m-2" HelperTextOnFocus="true" HelperText="Nhập ngày để chọn giai đoạn chạy tương ứng"
                                                @bind-Value="@stepModel.CurrentDay" For="@(()=>@stepModel.CurrentDay)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Bù nhiệt (oC)" Class="m-2" HelperTextOnFocus="true" HelperText="Giá trị offset nhiệt độ."
                                                @bind-Value="@stepModel.OffsetTemp" For="@(()=>@stepModel.OffsetTemp)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Trễ cảnh báo (oC)" Class="m-2"
                                                @bind-Value="@stepModel.DeadbandTemp" For="@(()=>@stepModel.DeadbandTemp)"></MudNumericField>
                                            </MudItem>
                                            <MudItem xs="12" sm="3">
                                                <MudNumericField Label="Reset giai đoạn" Class="m-2" HelperText="Cho chạy lại từ giai đoạn đầu tiên" HelperTextOnFocus="true"
                                                @bind-Value="@stepModel.ResetGiaiDoan" For="@(()=>@stepModel.ResetGiaiDoan)"></MudNumericField>
                                            </MudItem>
                                        </MudGrid>
                                    </MudCardContent>
                                </MudCard>
                            </MudItem>
                        </MudGrid>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton ButtonType="MudBlazor.ButtonType.Submit" FullWidth=true Variant="Variant.Filled" Color="Color.Primary" Class="btn btn-primary btn-lg btn-block">Cập nhật</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        </MudGrid>
    </EditForm>
}